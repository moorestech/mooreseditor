# システムパターン: MooresEditor

## アーキテクチャ概要

MooresEditorは、Remix.jsをベースにしたシングルページアプリケーション（SPA）として構築されています。全体のアーキテクチャは以下の主要コンポーネントで構成されています：

```
┌─────────────────────────────────────┐
│              UI Layer               │
│  ┌─────────────┐   ┌─────────────┐  │
│  │ SchemaEditor │   │   Routes    │  │
│  └─────────────┘   └─────────────┘  │
├─────────────────────────────────────┤
│            Business Logic           │
│  ┌─────────────┐   ┌─────────────┐  │
│  │    Hooks    │   │   Context   │  │
│  └─────────────┘   └─────────────┘  │
├─────────────────────────────────────┤
│              Data Layer             │
│  ┌─────────────┐   ┌─────────────┐  │
│  │ File System │   │   Schema    │  │
│  │    Access   │   │ Definitions │  │
│  └─────────────┘   └─────────────┘  │
└─────────────────────────────────────┘
```

## 主要コンポーネント

### 1. スキーマエディタ (`SchemaEditor`)
- 中核となるコンポーネントで、スキーマに基づいたデータ編集UIを提供
- 再利用可能な入力コンポーネントの集合体
- 階層的なデータ構造を編集するためのテーブルベースのインターフェース

### 2. 入力コンポーネント (`inputs/`)
- 各データ型に特化した入力コンポーネント
- 型安全な入力検証
- コンテキスト認識機能（例：外部キー参照）

### 3. カスタムフック
- `useEditorContext`: エディタの状態管理
- `useFileSystemAccess`: ファイルの読み書き操作
- `useForeignKeySystem`: 外部キー参照の管理
- `useMasterDirectory`: マスターデータディレクトリの管理

## デザインパターン

### 1. コンテキストベースの状態管理
- React Contextを使用して、深くネストされたコンポーネント間でデータを共有
- エディタの状態、検証状態、外部キー参照などの管理に使用

### 2. コンポジションパターン
- 小さな特化したコンポーネントを組み合わせて複雑なUIを構築
- 各入力タイプ（文字列、数値、配列、オブジェクトなど）に特化したコンポーネント

### 3. アダプタパターン
- JSONとJavaScriptオブジェクトの相互変換
- スキーマ定義と実際のUIコンポーネントの橋渡し
- 注: YAMLファイルは参照用のみで、実際の変換処理はサポートされていない

### 4. ストラテジーパターン
- データ型に応じて異なる入力戦略を使用
- 検証ルールの適用

## データフロー

```
┌──────────┐    ┌───────────┐    ┌────────────┐
│ スキーマ  │───▶│ エディタ  │───▶│ 検証エンジン │
│ 定義     │    │ コンテキスト│    └────────────┘
└──────────┘    └───────────┘           │
                      ▲                  ▼
                      │            ┌────────────┐
                      │            │  エラー/    │
┌──────────┐    ┌───────────┐     │  警告表示   │
│ ファイル  │◀───▶│ データ    │     └────────────┘
│ システム  │    │ モデル    │            │
└──────────┘    └───────────┘            ▼
                      ▲            ┌────────────┐
                      │            │  ユーザー   │
                      ▼            │  インタラク  │
                ┌───────────┐      │  ション     │
                │ UI       │◀─────└────────────┘
                │ コンポーネント│
                └───────────┘
```

## 重要な実装パス

### スキーマ読み込みフロー
1. ファイルシステムからスキーマ定義（JSON）を読み込み
2. JSONをJavaScriptオブジェクトに変換
3. スキーマ構造を解析してエディタコンテキストを初期化
4. UIコンポーネントをレンダリング

### データ編集フロー
1. ユーザーがUIを通じてデータを編集
2. 入力コンポーネントが変更をエディタコンテキストに通知
3. 検証エンジンが変更を検証
4. 有効な場合、変更がデータモデルに適用
5. 必要に応じてUIが更新

### 保存フロー
1. ユーザーが保存アクションを実行
2. データモデル全体の最終検証
3. JavaScriptオブジェクトをJSONに変換
4. ファイルシステムに書き込み